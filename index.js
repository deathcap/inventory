// Generated by CoffeeScript 1.6.3
(function() {
  var EventEmitter, Inventory, ItemPile, deepEqual,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  deepEqual = require('deep-equal');

  ItemPile = require('itempile');

  EventEmitter = (require('events')).EventEmitter;

  module.exports = Inventory = (function(_super) {
    __extends(Inventory, _super);

    function Inventory(xSize, ySize, opts) {
      var size;
      if (xSize == null) {
        xSize = 10;
      }
      if (ySize == null) {
        ySize = 1;
      }
      size = xSize * ySize;
      this.array = new Array(size);
      this.width = xSize;
      this.height = ySize;
    }

    Inventory.prototype.changed = function() {
      return this.emit('changed');
    };

    Inventory.prototype.give = function(itemPile) {
      var excess, i, _i, _j, _ref, _ref1;
      excess = itemPile.count;
      for (i = _i = 0, _ref = this.array.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
        if ((this.array[i] != null) && this.array[i].canPileWith(itemPile)) {
          excess = this.array[i].mergePile(itemPile);
        }
        if (itemPile.count === 0) {
          break;
        }
      }
      for (i = _j = 0, _ref1 = this.array.length; 0 <= _ref1 ? _j < _ref1 : _j > _ref1; i = 0 <= _ref1 ? ++_j : --_j) {
        if (this.array[i] == null) {
          this.array[i] = new ItemPile(itemPile.item, 0);
          excess = this.array[i].mergePile(itemPile);
          if (this.array[i].count === 0) {
            this.array[i] = void 0;
          }
        }
        if (itemPile.count === 0) {
          break;
        }
      }
      this.changed();
      return excess;
    };

    Inventory.prototype.take = function(itemPile) {
      var given, i, n, _i, _ref;
      for (i = _i = 0, _ref = this.array.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
        if ((this.array[i] != null) && this.array[i].matchesTypeAndTags(itemPile)) {
          n = Math.min(itemPile.count, this.array[i].count);
          itemPile.count -= n;
          given = this.takeAt(i, n);
        }
      }
      return this.changed();
    };

    Inventory.prototype.takeAt = function(position, count) {
      var ret;
      if (!this.array[position]) {
        return false;
      }
      ret = this.array[position].splitPile(count);
      if (this.array[position].count === 0) {
        this.array[position] = void 0;
      }
      this.changed();
      return ret;
    };

    Inventory.prototype.toString = function() {
      var a, i, itemPile, _i, _len, _ref;
      a = [];
      _ref = this.array;
      for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
        itemPile = _ref[i];
        if (itemPile == null) {
          a.push('');
        } else {
          a.push("" + itemPile);
        }
      }
      return a.join('\t');
    };

    Inventory.fromString = function(s) {
      var items, ret, strings;
      strings = s.split('\t');
      items = (function() {
        var _i, _len, _results;
        _results = [];
        for (_i = 0, _len = strings.length; _i < _len; _i++) {
          s = strings[_i];
          _results.push(ItemPile.fromString(s));
        }
        return _results;
      })();
      ret = new Inventory(items.length);
      ret.array = items;
      return ret;
    };

    Inventory.prototype.size = function() {
      return this.array.length;
    };

    Inventory.prototype.get = function(i) {
      return this.array[i];
    };

    Inventory.prototype.set = function(i, itemPile) {
      this.array[i] = itemPile;
      return this.changed();
    };

    Inventory.prototype.clear = function() {
      var i, _i, _ref, _results;
      _results = [];
      for (i = _i = 0, _ref = this.size(); 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
        _results.push(this.set(i, void 0));
      }
      return _results;
    };

    Inventory.prototype.transferTo = function(dest) {
      var i, _i, _ref, _results;
      _results = [];
      for (i = _i = 0, _ref = this.size(); 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
        dest.set(i, this.get(i));
        _results.push(this.set(i, void 0));
      }
      return _results;
    };

    return Inventory;

  })(EventEmitter);

}).call(this);
